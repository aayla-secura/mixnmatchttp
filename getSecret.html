<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<title></title>
		<script src="allfuncs.js" charset="utf-8"></script>
		<!-- <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script> -->
		<script src="jquery-1.12.0.min.js"></script>
		<script charset="utf-8">
			DEBUG = true;

			// Not working in Opera 11.52 and maybe other old browsers
			// $(document).ready(function () { logToConsole('ready') });
			// Not working in Opera 11.52 and maybe other old browsers
			// document.addEventListener("DOMContentLoaded", function (event) { logToConsole('DOM loaded') });
			document.onreadystatechange = function () {
				logToConsole('Doc state is ' + document.readyState);
				// interactive not triggering in Opera 11.52 and maybe other old browsers
				if (document.readyState === 'complete') {
					new_hostname = getPar(document.location, 'host');
					if (new_hostname) { }
					else if (window.location.hostname == 'localhost') {
						new_hostname = '127.0.0.1';
					}
					else if (window.location.hostname == '127.0.0.1') {
						new_hostname = 'localhost';
					}

					if (new_hostname) {
						logToConsole('Target host is ' + new_hostname);
						logToConsole('Current host is ' + window.location.host);
						target = window.location.protocol + '//' +
							window.location.host.replace(window.location.hostname, new_hostname);

						// Login to target
						hidden = 'visibility: hidden; width: 0; height: 0; border: 0; border: none;';
						ifr = $('<iframe>',{style: hidden, src: target + '/login.html'}).appendTo('body').load(function () {
							target += '/secret.txt';
							logToPage('Target is ' + target);
							function getLoadURL(origin, creds, extra) {
								return '/getData.html?goto=' + encodeURIComponent(
									target + '?origin=' + origin + '&creds=' + creds) + '&' + extra;
							};

							// create iFrames for all combinations of CORS headers
							// GET
							ifr = $('<iframe>',{style: hidden, src: getLoadURL('*', '1', '')}).appendTo('body');
							ifr = $('<iframe>',{style: hidden, src: getLoadURL('*', '0', '')}).appendTo('body');
							ifr = $('<iframe>',{style: hidden, src: getLoadURL('%%ECHO%%', '1', '')}).appendTo('body');
							ifr = $('<iframe>',{style: hidden, src: getLoadURL('%%ECHO%%', '0', '')}).appendTo('body');
							ifr = $('<iframe>',{style: hidden, src: getLoadURL('', '0', '')}).appendTo('body');
							// POST
							ifr = $('<iframe>',{style: hidden, src: getLoadURL('*', '1', 'post=1')}).appendTo('body');
							ifr = $('<iframe>',{style: hidden, src: getLoadURL('*', '0', 'post=1')}).appendTo('body');
							ifr = $('<iframe>',{style: hidden, src: getLoadURL('%%ECHO%%', '1', 'post=1')}).appendTo('body');
							ifr = $('<iframe>',{style: hidden, src: getLoadURL('%%ECHO%%', '0', 'post=1')}).appendTo('body');
							ifr = $('<iframe>',{style: hidden, src: getLoadURL('', '0', 'post=1')}).appendTo('body');
						});
					};
				};
			};
		</script>
	</head>
	<body>
	</body>
</html>
