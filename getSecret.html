<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<script src="js/allfuncs.js" charset="utf-8"></script>
		<script charset="utf-8">
			var DEBUG = true;

			registerWinOnLoad(function () {
				// check if full target host is given
				var new_host = getPar('host');
				if (! new_host) {
					// otherwise check hostname
					new_host = getPar('hostname');
					if (new_host) {
						new_host += ':' + window.location.port;
					}
				}
				if (! new_host) {
					// otherwise check port
					new_host = getPar('port');
					if (new_host) {
						new_host = window.location.hostname + ':' + new_host;
					}
				}

				if (new_host) { }
				else if (window.location.hostname == 'localhost') {
					new_host = '127.0.0.1' + ':' + window.location.port;
				}
				else if (window.location.hostname == '127.0.0.1') {
					new_host = 'localhost' + ':' + window.location.port;
				}

				if (new_host) {
					logToConsole('Target host is ' + new_host);
					logToConsole('Current host is ' + window.location.host);
					var target = window.location.protocol + '//' +
						window.location.host.replace(window.location.host, new_host);

					// Login to target
					var hidden = 'visibility: hidden; width: 0; height: 0; border: 0; border: none;';
					var frameStyle = 'width: 100%; height: 5em; border: none;';
					var ifr = addElement('iframe',{style: hidden, src: target + '/login.html'})
					registerOnLoad(ifr, function () {
						target += '/secret.txt';
						logToPage('Target is ' + target);
						function getLoadURL(origin, creds, post) {
							return '/getData.html?goto=' + encodeURIComponent(
								target + '?origin=' + origin + '&creds=' + (creds ? '1' : '0')) + '&post=' + (post ? '1' : '0');
						};

						// create iFrames for all combinations of CORS headers
						// GET
						addElement('iframe',{style: frameStyle, src: getLoadURL('*', true, false)});
						addElement('iframe',{style: frameStyle, src: getLoadURL('*', false, false)});
						addElement('iframe',{style: frameStyle, src: getLoadURL('%%ECHO%%', true, false)});
						addElement('iframe',{style: frameStyle, src: getLoadURL('%%ECHO%%', false, false)});
						addElement('iframe',{style: frameStyle, src: getLoadURL('', false, false)});
						// POST
						addElement('iframe',{style: frameStyle, src: getLoadURL('*', true, true)});
						addElement('iframe',{style: frameStyle, src: getLoadURL('*', false, true)});
						addElement('iframe',{style: frameStyle, src: getLoadURL('%%ECHO%%', true, true)});
						addElement('iframe',{style: frameStyle, src: getLoadURL('%%ECHO%%', false, true)});
						addElement('iframe',{style: frameStyle, src: getLoadURL('', false, true)});
					});
				}
			});
		</script>
	</head>
	<body>
	</body>
</html>
