<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<!-- <script src="js/jquery-1.8.0.min.js"></script> -->
		<script src="js/allfuncs.js" charset="utf-8"></script>
		<script charset="utf-8">
			DEBUG = true;

			registerOnReady(function () {
				// check if full target host is given
				new_host = getPar('host');
				if (! new_host) {
					// otherwise check hostname
					new_host = getPar('hostname');
					if (new_host) {
						new_host += ':' + window.location.port;
					}
				}
				if (! new_host) {
					// otherwise check port
					new_host = getPar('port');
					if (new_host) {
						new_host = window.location.hostname + ':' + new_host;
					}
				}

				if (new_host) { }
				else if (window.location.hostname == 'localhost') {
					new_host = '127.0.0.1' + ':' + window.location.port;
				}
				else if (window.location.hostname == '127.0.0.1') {
					new_host = 'localhost' + ':' + window.location.port;
				}

				if (new_host) {
					logToConsole('Target host is ' + new_host);
					logToConsole('Current host is ' + window.location.host);
					target = window.location.protocol + '//' +
						window.location.host.replace(window.location.host, new_host);

					// Login to target
					hidden = 'visibility: hidden; width: 0; height: 0; border: 0; border: none;';
					// frameStyle = hidden;
					frameStyle = 'width: 100%; height: 5em; border: none;';
					// ifr = $('<iframe>',{style: hidden, src: target + '/login.html'}).appendTo('body').load(function () {
					ifr = createElement('iframe',{style: hidden, src: target + '/login.html'})
					ifr.onload = function () {
						target += '/secret.txt';
						logToPage('Target is ' + target);
						function getLoadURL(origin, creds, post) {
							return '/getData.html?goto=' + encodeURIComponent(
								target + '?origin=' + origin + '&creds=' + (creds ? '1' : '0')) + '&post=' + (post ? '1' : '0');
						};

						// create iFrames for all combinations of CORS headers
						// GET
						// ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('*', true, false)}).appendTo('body');
						// ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('*', false, false)}).appendTo('body');
						// ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('%%ECHO%%', true, false)}).appendTo('body');
						// ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('%%ECHO%%', false, false)}).appendTo('body');
						// ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('', false, false)}).appendTo('body');
						// POST
						// ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('*', true, true)}).appendTo('body');
						// ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('*', false, true)}).appendTo('body');
						// ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('%%ECHO%%', true, true)}).appendTo('body');
						// ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('%%ECHO%%', false, true)}).appendTo('body');
						// ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('', false, true)}).appendTo('body');
						// GET
						ifr = createElement('iframe',{style: frameStyle, src: getLoadURL('*', true, false)});
						ifr = createElement('iframe',{style: frameStyle, src: getLoadURL('*', false, false)});
						ifr = createElement('iframe',{style: frameStyle, src: getLoadURL('%%ECHO%%', true, false)});
						ifr = createElement('iframe',{style: frameStyle, src: getLoadURL('%%ECHO%%', false, false)});
						ifr = createElement('iframe',{style: frameStyle, src: getLoadURL('', false, false)});
						// POST
						ifr = createElement('iframe',{style: frameStyle, src: getLoadURL('*', true, true)});
						ifr = createElement('iframe',{style: frameStyle, src: getLoadURL('*', false, true)});
						ifr = createElement('iframe',{style: frameStyle, src: getLoadURL('%%ECHO%%', true, true)});
						ifr = createElement('iframe',{style: frameStyle, src: getLoadURL('%%ECHO%%', false, true)});
						ifr = createElement('iframe',{style: frameStyle, src: getLoadURL('', false, true)});
					// });
					};
				}
			});
		</script>
	</head>
	<body>
	</body>
</html>
