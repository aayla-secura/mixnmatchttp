<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<script src="js/jquery-1.8.0.min.js"></script>
		<script src="js/allfuncs.js" charset="utf-8"></script>
		<script charset="utf-8">
			DEBUG = true;

			registerOnReady(function () {
				new_hostname = getPar(document.location, 'host');
				if (new_hostname) { }
				else if (window.location.hostname == 'localhost') {
					new_hostname = '127.0.0.1';
				}
				else if (window.location.hostname == '127.0.0.1') {
					new_hostname = 'localhost';
				}

				if (new_hostname) {
					logToConsole('Target host is ' + new_hostname);
					logToConsole('Current host is ' + window.location.host);
					target = window.location.protocol + '//' +
						window.location.host.replace(window.location.hostname, new_hostname);

					// Login to target
					hidden = 'visibility: hidden; width: 0; height: 0; border: 0; border: none;';
					// frameStyle = hidden;
					frameStyle = 'width: 100%; height: 5em; border: none;';
					ifr = $('<iframe>',{style: hidden, src: target + '/login.html'}).appendTo('body').load(function () {
						target += '/secret.txt';
						logToPage('Target is ' + target);
						function getLoadURL(origin, creds, post) {
							return '/getData.html?goto=' + encodeURIComponent(
								target + '?origin=' + origin + '&creds=' + (creds ? '1' : '0')) + '&post=' + (post ? '1' : '0');
						};

						// create iFrames for all combinations of CORS headers
						// GET
						ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('*', true, false)}).appendTo('body');
						ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('*', false, false)}).appendTo('body');
						ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('%%ECHO%%', true, false)}).appendTo('body');
						ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('%%ECHO%%', false, false)}).appendTo('body');
						ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('', false, false)}).appendTo('body');
						// POST
						ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('*', true, true)}).appendTo('body');
						ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('*', false, true)}).appendTo('body');
						ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('%%ECHO%%', true, true)}).appendTo('body');
						ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('%%ECHO%%', false, true)}).appendTo('body');
						ifr = $('<iframe>',{style: frameStyle, src: getLoadURL('', false, true)}).appendTo('body');
					});
				}
			});
		</script>
	</head>
	<body>
	</body>
</html>
